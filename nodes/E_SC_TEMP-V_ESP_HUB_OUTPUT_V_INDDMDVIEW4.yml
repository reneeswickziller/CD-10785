fileVersion: 1
id: 1e632ea5-29c1-4a01-81ff-6be6b4f86971
name: V_ESP_HUB_OUTPUT_V_INDDMDVIEW4
operation:
  config:
    insertStrategy: UNION
    postSQL: |
      delete from {{ ref('E_SC_TEMP', 'V_ESP_HUB_OUTPUT_V_INDDMDVIEW4')}}

      where SCENARIO='{{parameters.SIMULATION_NAME}}' 
      and "LOADDATETIMESTAMP" <=(SELECT WATER_MARKER_TIMESTAMP FROM {{ ref('E_SC_UTIL_USER','LOAD_CONTROL_SC_SPO') }}

                                WHERE PROCEDURE_NAME = 'BV_SP_DMDRES_NEEDDATE_INSERT'  and  SCENARIO_NAME='{{parameters.SIMULATION_NAME}}' );
    preSQL: |-

      delete from {{ ref('E_SC_TEMP', 'V_ESP_HUB_OUTPUT_V_INDDMDVIEW4')}}

      where (SNAPSHOTDATE,SCENARIO) IN (SELECT SNAPSHOTDATE,SIMULATION_NAME FROM {{ ref('E_SC_SP', 'ESP_HUB_OUTPUT_V_INDDMDVIEW') }}
                                              where SIMULATION_NAME='{{parameters.SIMULATION_NAME}}' 
                                              GROUP BY SNAPSHOTDATE,SIMULATION_NAME           
                                              );

                               
    selectDistinct: true
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: E_SC_TEMP
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dad74f73-6ca6-4200-a457-c06c318acd84
          stepCounter: 1e632ea5-29c1-4a01-81ff-6be6b4f86971
        config: {}
        dataType: DATE
        description: ""
        name: SNAPSHOTDATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a5e905fc-d030-4ab3-b23d-b5f928960241
                stepCounter: fd99e077-9ab3-4e16-865a-210fb0d0fb05
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3f4424fe-75e4-49f1-9754-e8b2417e9e4d
          stepCounter: 1e632ea5-29c1-4a01-81ff-6be6b4f86971
        config: {}
        dataType: VARCHAR(50)
        description: ""
        name: SCENARIO
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 89be418f-a720-4120-84a2-58f92616dfec
                stepCounter: fd99e077-9ab3-4e16-865a-210fb0d0fb05
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ff8880d1-c5fb-4749-b754-10f932f45d6e
          stepCounter: 1e632ea5-29c1-4a01-81ff-6be6b4f86971
        config: {}
        dataType: VARCHAR(50)
        description: ""
        name: ORDERID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 505049dc-3c0a-4794-9348-27cf4a2e503e
                stepCounter: fd99e077-9ab3-4e16-865a-210fb0d0fb05
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4cd15546-5a23-409a-82b6-962f9fd7b971
          stepCounter: 1e632ea5-29c1-4a01-81ff-6be6b4f86971
        config: {}
        dataType: VARCHAR(10)
        description: ""
        name: LOCATION
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 63fa561f-8213-49f8-91d3-712255d491b2
                stepCounter: fd99e077-9ab3-4e16-865a-210fb0d0fb05
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 410ccbe0-6377-4bbd-9013-15c154614d56
          stepCounter: 1e632ea5-29c1-4a01-81ff-6be6b4f86971
        config: {}
        dataType: VARCHAR(18)
        description: ""
        name: ITEM
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e1d7eed3-31bb-4b6f-b3e0-f7bc34d94e0e
                stepCounter: fd99e077-9ab3-4e16-865a-210fb0d0fb05
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3f572585-4cca-4b73-9d7e-9e991f9bee7c
          stepCounter: 1e632ea5-29c1-4a01-81ff-6be6b4f86971
        config: {}
        dataType: NUMBER(34,6)
        description: ""
        name: REQTIMELYQTY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a66fcaf7-22fb-4cc2-a7e9-9232fd40b9d9
                stepCounter: fd99e077-9ab3-4e16-865a-210fb0d0fb05
            transform: SUM("ESP_HUB_OUTPUT_V_INDDMDVIEW"."SCHEDQTY")
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 45a6f739-a7a6-4926-a797-dd273129840f
          stepCounter: 1e632ea5-29c1-4a01-81ff-6be6b4f86971
        config: {}
        dataType: TIMESTAMP_NTZ(9)
        description: ""
        name: LOADDATETIMESTAMP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3863dda5-71d6-4db6-be36-0fb21c63fe6d
                stepCounter: fd99e077-9ab3-4e16-865a-210fb0d0fb05
            transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 9d14cca3-d3a2-4480-a433-0b50b3b9bb74
          stepCounter: 1e632ea5-29c1-4a01-81ff-6be6b4f86971
        config: {}
        dataType: VARCHAR(10)
        defaultValue: ""
        description: ""
        name: DMDTYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: "'1'"
        transform: ""
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: E_SC_SP
            nodeName: ESP_HUB_OUTPUT_V_CUSTORDER
          - locationName: E_SC_SP
            nodeName: ESP_HUB_OUTPUT_V_INDDMDVIEW
          - locationName: E_SC_UTIL_USER
            nodeName: LOAD_CONTROL_SC_SPO
        join:
          joinCondition: |-
            FROM {{ ref('E_SC_SP', 'ESP_HUB_OUTPUT_V_INDDMDVIEW') }} "ESP_HUB_OUTPUT_V_INDDMDVIEW" 
            LEFT JOIN (SELECT DISTINCT
            "ORDERID", "ITEM","LOC","SIMULATION_NAME","SNAPSHOT_DATE","U_UNOFFSET_REQ_DATE","SHIPDATE","EARLYTARGETDUR"  FROM {{ref('E_SC_SP', 'ESP_HUB_OUTPUT_V_CUSTORDER') }} B) "ESP_HUB_OUTPUT_V_CUSTORDER"
            ON "ESP_HUB_OUTPUT_V_INDDMDVIEW"."EXTORDERID" = "ESP_HUB_OUTPUT_V_CUSTORDER".ORDERID
            AND "ESP_HUB_OUTPUT_V_INDDMDVIEW"."ITEM" = "ESP_HUB_OUTPUT_V_CUSTORDER".ITEM
            AND "ESP_HUB_OUTPUT_V_INDDMDVIEW"."LOC" = "ESP_HUB_OUTPUT_V_CUSTORDER".LOC
            AND "ESP_HUB_OUTPUT_V_INDDMDVIEW"."SIMULATION_NAME" = "ESP_HUB_OUTPUT_V_CUSTORDER".SIMULATION_NAME
            AND "ESP_HUB_OUTPUT_V_INDDMDVIEW"."SNAPSHOTDATE" = "ESP_HUB_OUTPUT_V_CUSTORDER".SNAPSHOT_DATE
            WHERE
            "ESP_HUB_OUTPUT_V_INDDMDVIEW"."DMDTYPE" = '1' AND
            "ESP_HUB_OUTPUT_V_INDDMDVIEW"."SIMULATION_NAME" <> 'WHATIF' AND
            "ESP_HUB_OUTPUT_V_INDDMDVIEW"."SCHEDDATE" <= DATEADD(DAY,"ESP_HUB_OUTPUT_V_CUSTORDER".EARLYTARGETDUR*(-1) ,"ESP_HUB_OUTPUT_V_CUSTORDER".SHIPDATE) 
            AND  "ESP_HUB_OUTPUT_V_INDDMDVIEW"."SIMULATION_NAME"='{{parameters.SIMULATION_NAME}}' 
            and "ESP_HUB_OUTPUT_V_INDDMDVIEW"."LOADDATETIMESTAMP">(SELECT WATER_MARKER_TIMESTAMP FROM {{ ref('E_SC_UTIL_USER','LOAD_CONTROL_SC_SPO') }}
                                                                    WHERE PROCEDURE_NAME = 'BV_SP_DMDRES_NEEDDATE_INSERT' AND SCENARIO_NAME='{{parameters.SIMULATION_NAME}}') 
            GROUP BY 
            ALL
        name: V_ESP_HUB_OUTPUT_V_INDDMDVIEW4
        noLinkRefs: []
  name: V_ESP_HUB_OUTPUT_V_INDDMDVIEW4
  overrideSQL: false
  schema: ""
  sqlType: persistentStage
  type: sql
  version: 1
type: Node
