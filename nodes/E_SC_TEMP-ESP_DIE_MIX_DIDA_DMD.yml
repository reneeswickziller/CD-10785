fileVersion: 1
id: 281924fb-06db-4693-b4e0-70b2835ded3a
name: ESP_DIE_MIX_DIDA_DMD
operation:
  config:
    insertStrategy: INSERT
    postSQL: |
      delete from {{ ref('E_SC_TEMP', 'ESP_DIE_MIX_DIDA_DMD')}}

      where  1= CASE WHEN '{{parameters.SCENARIO_NAME}}'='ALL' THEN 1
                 WHEN SCENARIO_NAME='{{parameters.SCENARIO_NAME}}' THEN 1
                 ELSE 0 END

      and "LOADDATETIMESTAMP" <=(SELECT WATER_MARKER_TIMESTAMP FROM {{ ref('E_SC_UTIL_USER','LOAD_CONTROL_SC_SPO') }}

                                WHERE PROCEDURE_NAME = 'BV_ESP_DIE_MIX_DIDA_INSERT'  and  SCENARIO_NAME='{{parameters.SCENARIO_NAME}}' );
    preSQL: |-

      delete from {{ ref('E_SC_TEMP', 'ESP_DIE_MIX_DIDA_DMD')}}

      where (SCENARIO_DATE,SCENARIO_NAME) IN (SELECT SNAPSHOTDATE,SIMULATION_NAME FROM {{ ref('E_SC_SP', 'ESP_HUB_OUTPUT_V_INDDMDLINK') }}
                                              where 1=CASE WHEN '{{parameters.SCENARIO_NAME}}'='ALL' THEN 1
                                                         WHEN SIMULATION_NAME='{{parameters.SCENARIO_NAME}}' THEN 1
                                                         ELSE 0 END 
                                              GROUP BY SNAPSHOTDATE,SIMULATION_NAME           
                                              );

                               
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: E_SC_TEMP
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7e842871-a059-4c73-a906-06f7f2596a4d
          stepCounter: 281924fb-06db-4693-b4e0-70b2835ded3a
        config: {}
        dataType: DATE
        description: ""
        hashDetails: null
        name: DMDNEEDDATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: febe5270-00d2-4177-b27c-b92f56549372
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 10ee4e71-0886-41a7-af1d-77a2fa49ee7c
          stepCounter: 281924fb-06db-4693-b4e0-70b2835ded3a
        config: {}
        dataType: TIMESTAMP_NTZ(9)
        description: ""
        hashDetails: null
        name: LOADDATETIMESTAMP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c3146ed0-927d-4835-8fb9-a63e233ad4d6
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fc4fec68-3d0c-4fbc-aac4-a098fabe534e
          stepCounter: 281924fb-06db-4693-b4e0-70b2835ded3a
        config: {}
        dataType: VARCHAR(18)
        description: ""
        hashDetails: null
        name: SUPPLY_FGPN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 26d5a93f-aca1-480b-ad80-3cccc0c67849
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d75cf56f-7928-4f72-8f93-c0e541f2f9ae
          stepCounter: 281924fb-06db-4693-b4e0-70b2835ded3a
        config: {}
        dataType: VARCHAR(18)
        description: ""
        hashDetails: null
        name: PARENTITEM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fcf2253b-9580-455f-b0cf-7214e452e5ed
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2a34bfe9-ab9e-4503-b8ec-f8287bd4a8bf
          stepCounter: 281924fb-06db-4693-b4e0-70b2835ded3a
        config: {}
        dataType: VARCHAR(5)
        description: ""
        hashDetails: null
        name: DMDTYPE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 865e75dd-a6cc-4445-8aa8-030a3698aeaa
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9eb4f9c0-a84f-412a-a448-08a4f1051ab6
          stepCounter: 281924fb-06db-4693-b4e0-70b2835ded3a
        config: {}
        dataType: VARCHAR(18)
        description: ""
        hashDetails: null
        name: DMD_FGPN
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b763552c-b9a3-40db-a88f-604265afcb5a
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0b9db97e-6943-4c34-bfc2-266eb039e99a
          stepCounter: 281924fb-06db-4693-b4e0-70b2835ded3a
        config: {}
        dataType: VARCHAR(50)
        description: ""
        hashDetails: null
        name: SCENARIO_NAME
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 37f63374-388c-4f79-8fed-f015a4132c27
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 877c3b8e-af47-4807-a06f-5c3047b87920
          stepCounter: 281924fb-06db-4693-b4e0-70b2835ded3a
        config: {}
        dataType: DATE
        description: ""
        hashDetails: null
        name: SCENARIO_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f097f6e0-e3aa-4fd6-a3bf-1fe3bd47b003
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ead24346-7759-4923-bd9d-080047da80a1
          stepCounter: 281924fb-06db-4693-b4e0-70b2835ded3a
        config: {}
        dataType: NUMBER(34,6)
        description: ""
        hashDetails: null
        name: DMDPEGQTY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 06019876-2ab0-4ea2-9be2-7409848bb4e3
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f1510c8b-0519-4a4d-9de9-ac96e58aed19
          stepCounter: 281924fb-06db-4693-b4e0-70b2835ded3a
        config: {}
        dataType: VARCHAR(30)
        description: ""
        name: DMD_MPN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ee8df4e7-2447-4b7c-bcf1-b31f8ed82636
                stepCounter: b1acad72-c964-40cb-9536-6187b3deeb87
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2202b3ea-419d-4fc5-94a8-f27c7776c4ff
          stepCounter: 281924fb-06db-4693-b4e0-70b2835ded3a
        config: {}
        dataType: VARCHAR(30)
        description: ""
        name: DMD_PCG
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 43d50934-7928-4378-8b25-a31919c29682
                stepCounter: b1acad72-c964-40cb-9536-6187b3deeb87
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 93a6cb34-c981-4757-92d8-25dc7b2e6970
          stepCounter: 281924fb-06db-4693-b4e0-70b2835ded3a
        config: {}
        dataType: VARCHAR(128)
        description: ""
        name: ENTBOM_TOAD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6c804256-982d-4732-ab8e-c00e705c8860
                stepCounter: b1acad72-c964-40cb-9536-6187b3deeb87
            transform: ""
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          D_ESP_MATERIAL_CHARACTERISTICS: e9250239-64d8-407a-8e52-ecf4c191d70c
          ESP_HUB_OUTPUT_V_INDDMDLINK: 90ebbb2e-ee8d-461d-a7ab-d9a66108476c
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: E_SC_MD
            nodeName: D_ESP_MATERIAL_CHARACTERISTICS
          - locationName: E_SC_SP
            nodeName: ESP_HUB_OUTPUT_V_INDDMDLINK
          - locationName: E_SC_UTIL_USER
            nodeName: LOAD_CONTROL_SC_SPO
        join:
          joinCondition: |
            FROM {{ ref('E_SC_SP', 'ESP_HUB_OUTPUT_V_INDDMDLINK') }} "ESP_HUB_OUTPUT_V_INDDMDLINK"
            INNER JOIN {{ ref('E_SC_MD', 'D_ESP_MATERIAL_CHARACTERISTICS') }} "D_ESP_MATERIAL_CHARACTERISTICS"
            ON "ESP_HUB_OUTPUT_V_INDDMDLINK"."DMDITEM" = "D_ESP_MATERIAL_CHARACTERISTICS"."PRODUCT_NUMBER"
            WHERE 1 = CASE WHEN '{{parameters.SCENARIO_NAME}}'='ALL' THEN 1
                           WHEN "ESP_HUB_OUTPUT_V_INDDMDLINK"."SIMULATION_NAME"='{{parameters.SCENARIO_NAME}}' THEN 1
                           ELSE 0 END
            and "ESP_HUB_OUTPUT_V_INDDMDLINK"."LOADDATETIMESTAMP">(SELECT WATER_MARKER_TIMESTAMP FROM {{ ref('E_SC_UTIL_USER','LOAD_CONTROL_SC_SPO') }}
                                                                    WHERE PROCEDURE_NAME = 'BV_ESP_DIE_MIX_DIDA_INSERT' AND SCENARIO_NAME='{{parameters.SCENARIO_NAME}}')
            and "D_ESP_MATERIAL_CHARACTERISTICS"."DESIGN_ID"='MIXED' 
            and "D_ESP_MATERIAL_CHARACTERISTICS"."MPN"!=''
        name: ESP_DIE_MIX_DIDA_DMD
        noLinkRefs: []
  name: ESP_DIE_MIX_DIDA_DMD
  overrideSQL: false
  schema: ""
  sqlType: persistentStage
  type: sql
  version: 1
type: Node
