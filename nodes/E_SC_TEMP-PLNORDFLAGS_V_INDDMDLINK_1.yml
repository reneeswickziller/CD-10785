fileVersion: 1
id: bf550ec0-152d-483b-ad1b-2b04d3f52f19
name: PLNORDFLAGS_V_INDDMDLINK_1
operation:
  config:
    insertStrategy: UNION
    postSQL: |-
      delete from {{ ref('E_SC_TEMP', 'PLNORDFLAGS_V_INDDMDLINK_1')}}

      where  1= CASE WHEN '{{parameters.SIMULATION_NAME}}'='ALL' THEN 1
                 WHEN SIMULATION_NAME='{{parameters.SIMULATION_NAME}}' THEN 1
                 ELSE 0 END

      and "LOADDATETIMESTAMP" <=(SELECT WATER_MARKER_TIMESTAMP FROM {{ ref('E_SC_UTIL_USER','LOAD_CONTROL_SC_SPO') }}

                                WHERE PROCEDURE_NAME = 'BV_ESP_PLAN_ORD_FLAGS_INSERT'  and  SCENARIO_NAME='{{parameters.SIMULATION_NAME}}' );
    preSQL: |-
      delete from {{ ref('E_SC_TEMP', 'PLNORDFLAGS_V_INDDMDLINK_1')}}

      where (SNAPSHOTDATE,SIMULATION_NAME) IN (SELECT SNAPSHOTDATE,SIMULATION_NAME FROM {{ ref('E_SC_SP', 'ESP_HUB_OUTPUT_V_INDDMDLINK') }}
                                              where SIMULATION_NAME='{{parameters.SIMULATION_NAME}}'
                                              AND "ESP_HUB_OUTPUT_V_INDDMDLINK"."LOADDATETIMESTAMP">(SELECT WATER_MARKER_TIMESTAMP FROM {{ ref('E_SC_UTIL_USER','LOAD_CONTROL_SC_SPO') }}
                                                              WHERE PROCEDURE_NAME = 'BV_ESP_PLAN_ORD_FLAGS_INSERT' AND SCENARIO_NAME='{{parameters.SIMULATION_NAME}}')
                                              GROUP BY SNAPSHOTDATE,SIMULATION_NAME           
                                              );
    selectDistinct: false
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: E_SC_TEMP
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 989ba7f9-8308-471d-af21-5a7019816dea
          stepCounter: bf550ec0-152d-483b-ad1b-2b04d3f52f19
        config: {}
        dataType: NUMBER(34,6)
        description: ""
        name: SUPPLYPEGQTY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 087924cc-603c-4243-a35c-be756e38f2f8
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: SUM("ESP_HUB_OUTPUT_V_INDDMDLINK"."SUPPLYPEGQTY")
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1948c813-79d0-4133-bc2d-0be5d14d431f
          stepCounter: bf550ec0-152d-483b-ad1b-2b04d3f52f19
        config: {}
        dataType: VARCHAR(5)
        description: ""
        name: SUPPLYTYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2b998d5a-0c42-4c4a-a070-98b9ab98abab
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 94e160d3-b3b2-4e11-a5fc-9b114ae22428
          stepCounter: bf550ec0-152d-483b-ad1b-2b04d3f52f19
        config: {}
        dataType: VARCHAR(50)
        description: ""
        name: SUPPLYSEQNUM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ec72d13b-bbd8-47e2-820c-29ae5ebbcc6c
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c1fe04c7-e2e2-4e4a-be26-fcad4d39d849
          stepCounter: bf550ec0-152d-483b-ad1b-2b04d3f52f19
        config: {}
        dataType: VARCHAR(10)
        description: ""
        name: SUPPLYLOC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2fb7b266-bef6-48e7-9f66-95416c48e701
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 04d4a5f3-edd8-4461-a431-ae342c4defbf
          stepCounter: bf550ec0-152d-483b-ad1b-2b04d3f52f19
        config: {}
        dataType: VARCHAR(18)
        description: ""
        name: SUPPLYITEM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 26d5a93f-aca1-480b-ad80-3cccc0c67849
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ac6b38b2-270f-44ed-b002-507761c89111
          stepCounter: bf550ec0-152d-483b-ad1b-2b04d3f52f19
        config: {}
        dataType: VARCHAR(10)
        description: ""
        name: DMDLOC
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 42354d86-1514-4308-be49-bb9f041c465e
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b44566f9-e61b-4bba-943d-1cf85a1f75be
          stepCounter: bf550ec0-152d-483b-ad1b-2b04d3f52f19
        config: {}
        dataType: VARCHAR(18)
        description: ""
        name: DMDITEM
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b763552c-b9a3-40db-a88f-604265afcb5a
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0babd798-52c9-40f8-97aa-ddd158d6375b
          stepCounter: bf550ec0-152d-483b-ad1b-2b04d3f52f19
        config: {}
        dataType: VARCHAR(50)
        description: ""
        name: SIMULATION_NAME
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 37f63374-388c-4f79-8fed-f015a4132c27
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8491c0ce-fb81-4a98-8af4-0ecfa381cc10
          stepCounter: bf550ec0-152d-483b-ad1b-2b04d3f52f19
        config: {}
        dataType: DATE
        description: ""
        name: SNAPSHOTDATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f097f6e0-e3aa-4fd6-a3bf-1fe3bd47b003
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1aef519c-cf6a-486f-8ff7-5622c048d3a4
          stepCounter: bf550ec0-152d-483b-ad1b-2b04d3f52f19
        config: {}
        dataType: TIMESTAMP_NTZ(9)
        description: ""
        name: LOADDATETIMESTAMP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c3146ed0-927d-4835-8fb9-a63e233ad4d6
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: E_SC_SP
            nodeName: ESP_HUB_OUTPUT_V_INDDMDLINK
          - locationName: E_SC_UTIL_USER
            nodeName: LOAD_CONTROL_SC_SPO
        join:
          joinCondition: |-
            FROM {{ ref('E_SC_SP', 'ESP_HUB_OUTPUT_V_INDDMDLINK') }} "ESP_HUB_OUTPUT_V_INDDMDLINK"
            WHERE "ESP_HUB_OUTPUT_V_INDDMDLINK"."SUPPLYTYPE" = '2'
            AND "ESP_HUB_OUTPUT_V_INDDMDLINK"."LOADDATETIMESTAMP">(SELECT WATER_MARKER_TIMESTAMP FROM {{ ref('E_SC_UTIL_USER','LOAD_CONTROL_SC_SPO') }}
                                                                    WHERE PROCEDURE_NAME = 'BV_ESP_PLAN_ORD_FLAGS_INSERT' AND SCENARIO_NAME='{{parameters.SIMULATION_NAME}}')
            AND "SIMULATION_NAME" = '{{parameters.SIMULATION_NAME}}'
            GROUP BY ALL
        name: PLNORDFLAGS_V_INDDMDLINK_1
        noLinkRefs: []
  name: PLNORDFLAGS_V_INDDMDLINK_1
  overrideSQL: false
  schema: ""
  sqlType: persistentStage
  type: sql
  version: 1
type: Node
