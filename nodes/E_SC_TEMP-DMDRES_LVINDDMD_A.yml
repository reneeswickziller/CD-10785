fileVersion: 1
id: d3a399d8-00d4-4314-a4ba-2ddc7fc02613
name: DMDRES_LVINDDMD_A
operation:
  config:
    insertStrategy: UNION
    postSQL: |
      delete from {{ ref('E_SC_TEMP', 'DMDRES_LVINDDMD_B')}}

      where  1= CASE WHEN '{{parameters.SIMULATION_NAME}}'='ALL' THEN 1
                 WHEN SCENARIO='{{parameters.SIMULATION_NAME}}' THEN 1
                 ELSE 0 END

      and "LOADDATETIMESTAMP" <=(SELECT WATER_MARKER_TIMESTAMP FROM {{ ref('E_SC_UTIL_USER','LOAD_CONTROL_SC_SPO') }}

                                WHERE PROCEDURE_NAME = 'BV_SP_DMDRES_NEEDDATE_INSERT'  and  SCENARIO_NAME='{{parameters.SIMULATION_NAME}}' );
    preSQL: |-

      delete from {{ ref('E_SC_TEMP', 'DMDRES_LVINDDMD_A')}}

      where (SNAPSHOTDATE,SCENARIO) IN (SELECT SNAPSHOTDATE,SIMULATION_NAME FROM {{ ref('E_SC_SP', 'ESP_HUB_OUTPUT_V_INDDMDLINK') }}
                                              where 1=CASE WHEN '{{parameters.SIMULATION_NAME}}'='ALL' THEN 1
                                                         WHEN SIMULATION_NAME='{{parameters.SIMULATION_NAME}}' THEN 1
                                                         ELSE 0 END 
                                              GROUP BY SNAPSHOTDATE,SIMULATION_NAME           
                                              );

                               
    selectDistinct: false
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: E_SC_TEMP
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 48d10f28-7137-49e4-91b5-b5235c0c4d3a
          stepCounter: d3a399d8-00d4-4314-a4ba-2ddc7fc02613
        config: {}
        dataType: DATE
        description: ""
        name: SNAPSHOTDATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f097f6e0-e3aa-4fd6-a3bf-1fe3bd47b003
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 05666970-4c25-479d-a95b-7f662f9e3a6b
          stepCounter: d3a399d8-00d4-4314-a4ba-2ddc7fc02613
        config: {}
        dataType: VARCHAR(50)
        description: ""
        name: SCENARIO
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 37f63374-388c-4f79-8fed-f015a4132c27
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c118dc5e-158e-4edd-b982-45ca4771a564
          stepCounter: d3a399d8-00d4-4314-a4ba-2ddc7fc02613
        config: {}
        dataType: VARCHAR(18)
        description: ""
        name: ITEM
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b763552c-b9a3-40db-a88f-604265afcb5a
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ec98bb3b-71a7-45be-8266-8b3f9a9f4b86
          stepCounter: d3a399d8-00d4-4314-a4ba-2ddc7fc02613
        config: {}
        dataType: VARCHAR(10)
        description: ""
        name: LOCATION
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 42354d86-1514-4308-be49-bb9f041c465e
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6e04b4e4-10a0-4532-affb-f2366de0f69d
          stepCounter: d3a399d8-00d4-4314-a4ba-2ddc7fc02613
        config: {}
        dataType: VARCHAR(50)
        description: ""
        name: ORDERID
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 08b32fbe-8412-4a24-bd26-fdcd9e17c9cb
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 535c4b1f-8079-4257-b790-d080f79a03b7
          stepCounter: d3a399d8-00d4-4314-a4ba-2ddc7fc02613
        config: {}
        dataType: VARCHAR(5)
        description: ""
        name: DMDTYPE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 865e75dd-a6cc-4445-8aa8-030a3698aeaa
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6638359f-4c2d-47b0-ac2c-dbf205e0cc67
          stepCounter: d3a399d8-00d4-4314-a4ba-2ddc7fc02613
        config: {}
        dataType: VARCHAR(5)
        description: ""
        name: SUPPLYTYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2b998d5a-0c42-4c4a-a070-98b9ab98abab
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 46a949de-3c46-49aa-80c8-debd3d04b546
          stepCounter: d3a399d8-00d4-4314-a4ba-2ddc7fc02613
        config: {}
        dataType: TIMESTAMP_NTZ(9)
        description: ""
        name: LOADDATETIMESTAMP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c3146ed0-927d-4835-8fb9-a63e233ad4d6
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: E_SC_SP
            nodeName: ESP_HUB_OUTPUT_V_INDDMDLINK
          - locationName: E_SC_UTIL_USER
            nodeName: LOAD_CONTROL_SC_SPO
        join:
          joinCondition: |-
            FROM {{ ref('E_SC_SP', 'ESP_HUB_OUTPUT_V_INDDMDLINK') }} "ESP_HUB_OUTPUT_V_INDDMDLINK"
            WHERE "SUPPLYTYPE" = '7' AND "DMDTYPE" = '1'
            AND 1 = CASE WHEN '{{parameters.SIMULATION_NAME}}'='ALL' THEN 1
                           WHEN "ESP_HUB_OUTPUT_V_INDDMDLINK"."SIMULATION_NAME"='{{parameters.SIMULATION_NAME}}' THEN 1
                           ELSE 0 END
            and "ESP_HUB_OUTPUT_V_INDDMDLINK"."LOADDATETIMESTAMP">(SELECT WATER_MARKER_TIMESTAMP FROM {{ ref('E_SC_UTIL_USER','LOAD_CONTROL_SC_SPO') }}
                                                                    WHERE PROCEDURE_NAME = 'BV_SP_DMDRES_NEEDDATE_INSERT' AND SCENARIO_NAME='{{parameters.SIMULATION_NAME}}')
            GROUP BY ALL
        name: DMDRES_LVINDDMD_A
        noLinkRefs: []
  name: DMDRES_LVINDDMD_A
  overrideSQL: false
  schema: ""
  sqlType: persistentStage
  type: sql
  version: 1
type: Node
