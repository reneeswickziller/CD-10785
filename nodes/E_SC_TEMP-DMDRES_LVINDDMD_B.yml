fileVersion: 1
id: dadacd52-5611-4b88-b122-266923df5753
name: DMDRES_LVINDDMD_B
operation:
  config:
    insertStrategy: UNION
    postSQL: |
      delete from {{ ref('E_SC_TEMP', 'DMDRES_LVINDDMD_B')}}

      where  1= CASE WHEN '{{parameters.SIMULATION_NAME}}'='ALL' THEN 1
                 WHEN SCENARIO='{{parameters.SIMULATION_NAME}}' THEN 1
                 ELSE 0 END

      and "LOADDATETIMESTAMP" <=(SELECT WATER_MARKER_TIMESTAMP FROM {{ ref('E_SC_UTIL_USER','LOAD_CONTROL_SC_SPO') }}

                                WHERE PROCEDURE_NAME = 'BV_SP_DMDRES_NEEDDATE_INSERT'  and  SCENARIO_NAME='{{parameters.SIMULATION_NAME}}' );
    preSQL: |-

      delete from {{ ref('E_SC_TEMP', 'DMDRES_LVINDDMD_B')}}

      where (SNAPSHOTDATE,SCENARIO) IN (SELECT SNAPSHOTDATE,SIMULATION_NAME FROM {{ ref('E_SC_SP', 'ESP_HUB_OUTPUT_V_INDDMDLINK') }}
                                              where 1=CASE WHEN '{{parameters.SIMULATION_NAME}}'='ALL' THEN 1
                                                         WHEN SIMULATION_NAME='{{parameters.SIMULATION_NAME}}' THEN 1
                                                         ELSE 0 END 
                                              GROUP BY SNAPSHOTDATE,SIMULATION_NAME           
                                              );

                               
    selectDistinct: false
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: E_SC_TEMP
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c6f22871-28f6-46ef-8ed4-2114bc7a3a09
          stepCounter: dadacd52-5611-4b88-b122-266923df5753
        config: {}
        dataType: DATE
        description: ""
        name: SNAPSHOTDATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f097f6e0-e3aa-4fd6-a3bf-1fe3bd47b003
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 894a1831-3f23-4882-be1a-08471d222e7e
          stepCounter: dadacd52-5611-4b88-b122-266923df5753
        config: {}
        dataType: VARCHAR(50)
        description: ""
        name: SCENARIO
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 37f63374-388c-4f79-8fed-f015a4132c27
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 39b3669b-1be3-4c45-920c-014bcc4f8f68
          stepCounter: dadacd52-5611-4b88-b122-266923df5753
        config: {}
        dataType: VARCHAR(18)
        description: ""
        name: ITEM
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b763552c-b9a3-40db-a88f-604265afcb5a
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8b9cd0da-b3e6-4923-ada4-77bcae7298b8
          stepCounter: dadacd52-5611-4b88-b122-266923df5753
        config: {}
        dataType: VARCHAR(10)
        description: ""
        name: LOCATION
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 42354d86-1514-4308-be49-bb9f041c465e
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5994f4d6-c0fe-400d-8857-cabd19086145
          stepCounter: dadacd52-5611-4b88-b122-266923df5753
        config: {}
        dataType: VARCHAR(50)
        description: ""
        name: ORDERID
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 08b32fbe-8412-4a24-bd26-fdcd9e17c9cb
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 21dccae1-1b5b-4f61-a8f4-449c8491b49c
          stepCounter: dadacd52-5611-4b88-b122-266923df5753
        config: {}
        dataType: VARCHAR(5)
        description: ""
        name: DMDTYPE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 865e75dd-a6cc-4445-8aa8-030a3698aeaa
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d8174ebf-58e6-46b1-bd44-cfaab702e460
          stepCounter: dadacd52-5611-4b88-b122-266923df5753
        config: {}
        dataType: VARCHAR(5)
        description: ""
        name: SUPPLYTYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2b998d5a-0c42-4c4a-a070-98b9ab98abab
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2e2a2d4f-6eaf-4230-b81c-31fe27158381
          stepCounter: dadacd52-5611-4b88-b122-266923df5753
        config: {}
        dataType: TIMESTAMP_NTZ(9)
        description: ""
        name: LOADDATETIMESTAMP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c3146ed0-927d-4835-8fb9-a63e233ad4d6
                stepCounter: dd52a822-e49a-41d3-9a91-5840a0a27a26
            transform: ""
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: E_SC_SP
            nodeName: ESP_HUB_OUTPUT_V_INDDMDLINK
          - locationName: E_SC_UTIL_USER
            nodeName: LOAD_CONTROL_SC_SPO
        join:
          joinCondition: |-
            FROM {{ ref('E_SC_SP', 'ESP_HUB_OUTPUT_V_INDDMDLINK') }} "ESP_HUB_OUTPUT_V_INDDMDLINK"
            WHERE "SUPPLYTYPE" = '7' AND DMDTYPE = '2'
            AND 1 = CASE WHEN '{{parameters.SIMULATION_NAME}}'='ALL' THEN 1
                           WHEN "ESP_HUB_OUTPUT_V_INDDMDLINK"."SIMULATION_NAME"='{{parameters.SIMULATION_NAME}}' THEN 1
                           ELSE 0 END
            and "ESP_HUB_OUTPUT_V_INDDMDLINK"."LOADDATETIMESTAMP">(SELECT WATER_MARKER_TIMESTAMP FROM {{ ref('E_SC_UTIL_USER','LOAD_CONTROL_SC_SPO') }}
                                                                    WHERE PROCEDURE_NAME = 'BV_SP_DMDRES_NEEDDATE_INSERT' AND SCENARIO_NAME='{{parameters.SIMULATION_NAME}}')
            GROUP BY ALL
        name: DMDRES_LVINDDMD_B
        noLinkRefs: []
  name: DMDRES_LVINDDMD_B
  overrideSQL: false
  schema: ""
  sqlType: persistentStage
  type: sql
  version: 1
type: Node
